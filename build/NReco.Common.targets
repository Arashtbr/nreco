<!--
Properties: NRecoRepoRootDirectory, NRecoTargetDirectory
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Target Name="NRecoApplyTransformRules">
        <Error Condition="'$(NRecoRepoRootDirectory)'==''" Text="NReco repository root directory (NRecoRepoRootDirectory) is not defined."/>
        <Error Condition="'$(NRecoTargetDirectory)'==''" Text="NReco target directory (NRecoTargetDirectory) is not defined."/>
		
		<MakeDir
            Directories="$(NRecoTargetDirectory)/.nreco"/>
		<Exec Command="$(NRecoRepoRootDirectory)\build\NReco.Transform.Tool\NReco.Transform.Tool.exe -i true -b $(NRecoTargetDirectory) > $(NRecoTargetDirectory)\.nreco\transform.log" WorkingDirectory="$(NRecoTargetDirectory)"/>
		
		<Message Text="Rules processed for $(NRecoTargetDirectory)"/>
	</Target>
	
	<ItemGroup>
		<WebappBinFiles Include="$(ProjectDir)$(OutputPath)\*.dll"/>
		<WebappBinFiles Include="$(ProjectDir)$(OutputPath)\*.pdb"/>
	</ItemGroup>
	<Target Name="NRecoPrepareWebapp">
		<!-- lets assume that files with build actions 'None','Content' are ASP.NET application files. -->
        <Copy
			SourceFiles="@(None)"
            DestinationFiles="@(None->'$(NRecoTargetDirectory)\%(RelativeDir)%(Filename)%(Extension)')"
			SkipUnchangedFiles="true"
        />
        <Copy
			SourceFiles="@(Content)"
            DestinationFiles="@(Content->'$(NRecoTargetDirectory)\%(RelativeDir)%(Filename)%(Extension)')"
			SkipUnchangedFiles="true"
        />
        <Copy
            SourceFiles="@(WebappBinFiles)"
            DestinationFiles="@(WebappBinFiles->'$(NRecoTargetDirectory)\bin\%(Filename)%(Extension)')"
			SkipUnchangedFiles="true"
        />
	</Target>
	
</Project>