<!--
Properties: NRecoRepoRootDirectory, NRecoTargetDirectory
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Target Name="NRecoApplyTransformRules">
        <Error Condition="'$(NRecoRepoRootDirectory)'==''" Text="NReco repository root directory (NRecoRepoRootDirectory) is not defined."/>
        <Error Condition="'$(NRecoTargetDirectory)'==''" Text="NReco target directory (NRecoTargetDirectory) is not defined."/>
		
		<MakeDir
            Directories="$(NRecoTargetDirectory)/.nreco"/>
		<Exec Command="$(NRecoRepoRootDirectory)\build\NReco.Transform.Tool\NReco.Transform.Tool.exe -i true -b $(NRecoTargetDirectory) > $(NRecoTargetDirectory)\.nreco\transform.log" WorkingDirectory="$(NRecoTargetDirectory)"/>
		
		<Message Text="Rules processed for $(NRecoTargetDirectory)"/>
	</Target>
	
	<ItemGroup>
		<WebappBinFiles Include="$(ProjectDir)$(OutputPath)\*.dll"/>
		<WebappBinFiles Include="$(ProjectDir)$(OutputPath)\*.pdb"/>
		<WebappFiles Include="*.asax;*.asax.cs;*.axd;*.axd.cs;*.sitemap"/>
		<WebappFiles 
			Include="**\*.aspx;**\*.aspx.cs;**\*.ascx;*.ascx.cs;**\*.ashx;**\*.ashx.cs;**\*.asmx;**\*.asmx.cs;**\*.browser;**\*.config;**\*.licx;**\*.master" 
			Exclude="web\**"/>
		<WebappFiles Include="App_Code\*.cs" />
		<WebappFiles Include="App_Code\*.jsl" />
		<WebappFiles Include="App_Code\*.vb" />
		<WebappFiles Include="App_WebReferences\*.disco" />
		<WebappFiles Include="App_Themes\*.skin" />
	</ItemGroup>
	<Target Name="NRecoPrepareWebapp">
        <Copy
            SourceFiles="@(WebappFiles)"
            DestinationFiles="@(WebappFiles->'$(NRecoTargetDirectory)\%(RecursiveDir)%(Filename)%(Extension)')"
			SkipUnchangedFiles="true"
        />
        <Copy
            SourceFiles="@(WebappBinFiles)"
            DestinationFiles="@(WebappBinFiles->'$(NRecoTargetDirectory)\bin\%(Filename)%(Extension)')"
			SkipUnchangedFiles="true"
        />
	</Target>
	
</Project>