<components xmlns:r="urn:schemas-nreco:nreco:core:v1" >
	
	<db-dalc name="db" xmlns="urn:schemas-nreco:nicnet:dalc:v1">
		<driver>
			<mssql>
				<connection><string name="mainDb"/></connection>			 
			</mssql>			
		</driver>
		<permissions>
			<query sourcename="accounts" operation="retrieve">
				1=1
			</query>
			<query sourcename="accounts" operation="update">
				username="{var:arg}"
			</query>
		</permissions>
		<dataviews>
			<view name="accounts_view" origin="aa">
				<fields>
					<select>*</select>
					<count>count(*)</count>
					<mapping>
						<field name="account_id">a.id</field>				   
					</mapping>
				</fields>
				<sql>select {var:fields} from accounts a</sql>	 
			</view>		  
		</dataviews>
		<triggers>
			<datarow event="updating" sourcename="accounts">
				<r:invoke-operation method="set_Item">
					<r:target><r:linq>var["row"]</r:linq></r:target>
					<r:args>
						<r:const value="creation_date"/>
						<r:ognl>@DateTime@Now</r:ognl>
					</r:args>
				</r:invoke-operation>
			</datarow>
		</triggers>
	</db-dalc>	
	
	
</components>
