<components 
	xmlns:r="urn:schemas-nreco:nreco:core:v1"
	xmlns:d="urn:schemas-nreco:nicnet:dalc:v1">
	<r:const-provider name="pageTypesLookup">
		<r:ref name="pageTypes"/>
	</r:const-provider>

	<r:invoke-operation name="pageTypeCaption" target="pageTypes" method="get_Item">
		<r:args><r:context/></r:args>
	</r:invoke-operation>
	
	<r:name-value name="pageTypes">
		<r:entry key="wiki">Wiki Syntax</r:entry>
		<r:entry key="html">HTML</r:entry>
		<r:entry key="text">Text</r:entry>
	</r:name-value>

	<r:chain-provider name="getPageHtml" result="html">
		<r:provide result="parser">
			<r:target>
				<r:invoke target="pageTypeParsers" method="get_Item">
					<r:args><r:ognl>#arg['content_type']</r:ognl></r:args>
				</r:invoke>
			</r:target>
		</r:provide>
		<r:provide result="html">
			<r:target>
				<r:invoke method="Provide">
					<r:target><r:ognl>#parser</r:ognl></r:target>
					<r:args>
						<r:ognl>#arg['content']</r:ognl>
					</r:args>
				</r:invoke>
			</r:target>
		</r:provide>
	</r:chain-provider>
	
	<r:name-value name="pageTypeParsers">
		<r:entry key="wiki">
			<r:invoke-operation target="wikiCreoleParser" method="ToHTML">
				<r:args><r:context/></r:args>
			</r:invoke-operation>
		</r:entry>
		<r:entry key="html">
			<r:context-provider/>
		</r:entry>
		<r:entry key="text">
			<r:provider-call>
				<r:context>
					<r:dictionary>
						<r:entry key="arg"><r:context/></r:entry>
					</r:dictionary>
				</r:context>
				<r:target>
					<r:linq>
						Convert.ToString(var["arg"]).Replace( Char.ConvertFromUtf32(10),"&lt;br/&gt;")
					</r:linq>
				</r:target>
			</r:provider-call>
		</r:entry>
	</r:name-value>

	<r:chain-provider name="accountsLookup" result="lookup">
		<r:provide result="accounts">
			<r:target>
				<d:dalc-provider from="db" query="accounts[id,username]" result="recordlist"/>
			</r:target>
		</r:provide>
		<r:provide result="lookup">
			<r:context><r:ognl>#accounts</r:ognl></r:context>
			<r:target>
				<r:listdictionary>
					<r:key><r:ognl>#id</r:ognl></r:key>
					<r:value><r:ognl>#username</r:ognl></r:value>
				</r:listdictionary>
			</r:target>
		</r:provide>
	</r:chain-provider>

	<r:chain-provider name="rolesLookup" result="lookup">
		<r:provide result="roles">
			<r:target>
				<r:invoke method="LoadAll" target="accountRoleStorage"/>
			</r:target>
		</r:provide>
		<r:provide result="lookup">
			<r:context>
				<r:ognl>#roles</r:ognl>
			</r:context>
			<r:target>
				<r:listdictionary>
					<r:key>
						<r:invoke method="get_Name">
							<r:target><r:context/></r:target>
						</r:invoke>
					</r:key>
					<r:value>
						<r:invoke method="get_Description">
							<r:target><r:context/></r:target>
						</r:invoke>
					</r:value>
				</r:listdictionary>
			</r:target>
		</r:provide>
	</r:chain-provider>


</components>
