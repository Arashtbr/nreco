<components xmlns:xi="http://www.w3.org/2003/XInclude">
	
	<views xmlns="urn:schemas-nreco:nreco:web:layout:v1">
		
		<form name="PageForm" caption="Page">
			<datasources>
				<dalc id="pageDS" sourcename="pages" condition='id="{var:id}" or title="{var:title}"'/>
			</datasources>
			<action name="inserted">
				<redirect><route name="PageForm"/></redirect>
			</action>
			<action name="deleted">
				<redirect><route name="PageList"/></redirect>
			</action>
			
			<field name="title" caption="Title">
				<editor>
					<textbox/>
					<validators>
						<required/>
						<regex>^[a-zA-Z][a-zA-Z0-9_-]*$</regex>
					</validators>
				</editor>
			</field>

			<field name="content_type" caption="Type" format="{0}" lookup="pageTypeCaption">
				<editor>
					<dropdownlist lookup="pageTypesLookup"/>
				</editor>
			</field>

			<field name="is_public" caption="Is Public?">
				<editor><checkbox/></editor>
			</field>

			<field caption="Visible For" edit="true" view="false" add="true">
				<editor>
					<checkboxlist lookup="accountsLookup">
						<relation sourcename="page_visibility" left="page_id" right="account_id"/>
					</checkboxlist>
				</editor>
			</field>
			
			<field name="content" caption="Content" layout="vertical">
				<renderer>
					<expression>
						<lookup service="getPageHtml">
							<dictionary>
								<entry key="content_type"><get name="content_type"/></entry>
								<entry key="content"><get name="content"/></entry>
							</dictionary>
						</lookup>
					</expression>
				</renderer>
				<editor>
					<textarea rows="10"/>
				</editor>
			</field>

		</form>

		<list name="PageList" caption="Pages" edit="true">
			<datasources>
				<dalc id="pageDS" sourcename="pages" selectsourcename="pages_view"/>
        <dalc id="chartPageDS" sourcename="pages" selectsourcename="charts_pages_type_view"/>
      </datasources>

			<field caption="Title" name="title" sort="true">
				<renderer>
					<link>
						<url>
							<route name="wikiPageForm"/>
						</url>
						<caption><expression><get name="title"/></expression></caption>
					</link>
				</renderer>
				<editor><textbox/></editor>
			</field>
			<field caption="Type" name="content_type" sort="true" lookup="pageTypeCaption">
				<editor>
					<dropdownlist lookup="pageTypesLookup"/>
				</editor>
			</field>
			<field name="author" sort="true" caption="Author">
				<renderer>
					<link>
						<url>
							<route name="AccountForm">
								<dictionary>
									<entry key="id">
										<get name="author_id"/>
									</entry>
								</dictionary>
							</route>
						</url>
						<caption><field name="author"/></caption>
					</link>
				</renderer>
			</field>
			<field edit="false">
				<renderer>
					<link caption="View">
						<url><route name="PageForm"/></url>
					</link>
					<linkbutton caption="Edit Title" command="Edit"/>
					<linkbutton caption="Delete" command="Delete"/>
				</renderer>
			</field>
			<field view="false">
				<renderer>
					<linkbutton caption="Save" command="Update"/>
					<linkbutton caption="Cancel" command="Cancel"/>
				</renderer>
			</field>
			<!--field caption="My chart">
        <renderer>
          <chart name="bla" width="400" height="200" datasource="chartPageDS">
            <series>
              <serie value-type="string" name="aaa" x-value="content_type" y-value="count_type" diagram-type="Column" isShowLegend="true"></serie>
            </series>
            <legends>
              <legend enabled="true" isTextAutoFit="true" name="bla"/>
            </legends>
            <chartArea name="bla" is3DStyle="false">
              <axisX name="Content type">
                <label angle="-90" interval="1"/>
              </axisX>
              <axisY name="Count">
                <label angle="-90" interval="1"/>
              </axisY>
            </chartArea>
          </chart>
        </renderer>
      </field-->

		</list>


    <!-- end my -->
    
		<form name="AccountForm" caption="Account">
			<datasources>
				<dalc id="accountDS" sourcename="accounts" condition='id="{var:id}"'/>
				<dalc id="phoneDS" sourcename="account_phones" condition='account_id="{var:id}"' insertmode='false'/>
			</datasources>
			<action name="inserted">
				<redirect>
					<route name="AccountForm"/>
				</redirect>
			</action>
			<action name="deleted">
				<redirect>
					<route name="AccountList"/>
				</redirect>
			</action>

			<field name="username" caption="Username">
				<editor>
					<textbox/>
					<validators>
						<required/>
					</validators>
				</editor>
			</field>

			<field name="password" caption="Password" view="false">
				<editor>
					<textbox/>
					<validators>
						<required/>
					</validators>
				</editor>
			</field>

			<field name="is_approved" caption="Approved?">
				<editor>
					<checkbox/>
				</editor>
			</field>

			<field name="email" caption="Email">
				<editor>
					<textbox/>
				</editor>
			</field>
			<field name="comment" caption="Comment">
				<editor>
					<textbox/>
				</editor>
			</field>

			<field caption="Roles" edit="true" view="false" add="true">
				<editor>
					<checkboxlist lookup="rolesLookup" id="username">
						<relation sourcename="account_roles" left="username" right="rolename"/>
					</checkboxlist>
				</editor>
			</field>

			<field caption="Phones" edit="false" add="false">
				<renderer>
					<list datasource="phoneDS" edit="true" add="true">
						<action name="inserting">
							<set name="account_id"><pagecontext name="id"/></set>
						</action>
						<field name="phone_number" caption="Number">
							<editor><textbox/></editor>
						</field>
						<field name="comment" caption="Comment">
							<editor><textbox/></editor>
						</field>
						<field edit="false" add="false">
							<renderer>
								<linkbutton caption="Edit" command="Edit"/>
								<linkbutton caption="Delete" command="Delete"/>
							</renderer>
						</field>
						<field view="false" add="false">
							<renderer>
								<linkbutton caption="Save" command="Update"/>
								<linkbutton caption="Cancel" command="Cancel"/>
							</renderer>
						</field>
						<field view="false" edit="false">
							<renderer>
								<linkbutton caption="Save" command="Insert"/>
								<linkbutton caption="Cancel" command="Cancel"/>
							</renderer>
						</field>
					</list>
				</renderer>
			</field>

		</form>

		<list name="AccountList" caption="Accounts" edit="true">
			<datasources>
				<dalc id="pageDS" sourcename="accounts" selectsourcename="accounts_view"/>
			</datasources>

			<field caption="ID" name="id" sort="true"/>
			<field caption="Username" name="username" sort="true"/>
			<field caption="Email" name="email" sort="true">
				<editor><textbox/></editor>
			</field>
			<field caption="Registered" name="creation_date" sort="true"/>
			<field edit="false">
				<renderer>
					<link caption="View">
						<url>
							<route name="AccountForm"/>
						</url>
					</link>
					<linkbutton caption="Change Email" command="Edit"/>
					<linkbutton caption="Delete" command="Delete"/>
				</renderer>
			</field>
			<field view="false">
				<renderer>
					<linkbutton caption="Save" command="Update"/>
					<linkbutton caption="Cancel" command="Cancel"/>
				</renderer>
			</field>

		</list>

	</views>
</components>